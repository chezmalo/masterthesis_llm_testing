id: CASE-007
input_tables:
  TRANSACTIONS:
    columns:
      - {name: CUSTOMER_ID, type: INT, nullable: false}
      - {name: BOOKING_DATE, type: DATE, nullable: true}
      - {name: AMOUNT_EUR, type: DECIMAL(12,2), nullable: true}
  CUSTOMER_CHURN:
    columns:
      - {name: CUSTOMER_ID, type: INT, nullable: false}
      - {name: LAST_TX_DATE, type: DATE, nullable: true}
      - {name: IS_INACTIVE, type: VARCHAR(5), nullable: false}
sql_script: |
  INSERT INTO CUSTOMER_CHURN (CUSTOMER_ID, LAST_TX_DATE, IS_INACTIVE)
  SELECT
    CUSTOMER_ID,
    MIN(t.BOOKING_DATE) AS LAST_TX_DATE,
    CASE
      WHEN DATEDIFF(day, CURRENT_DATE, MIN(t.BOOKING_DATE)) > 180 THEN 'TRUE'
      ELSE NULL
    END AS IS_INACTIVE
  FROM TRANSACTIONS t
  GROUP BY t.CUSTOMER_ID;
